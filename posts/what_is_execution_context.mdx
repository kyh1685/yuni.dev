---
title: 실행 컨텍스트(Execution Context)란?
date: 2023-07-07
description: 자바스크립트의 핵심 개념인 실행 컨텍스트에 대해 알아보자
tags: ["JavaScript"]
---

## 소스코드 실행 과정

모든 소스코드는 실행하기 전에 평가 과정을 거치며 코드를 실행하기 위한 준비를 한다. 다시 말해, 자바스크립트 엔진은 소스코드를 2개의 과정, 즉 **`소스코드의 평가` 와 `소스코드의 실행` 과정으로 나누어 처리한다.**

**소스코드 평가 과정에서는 실행 컨텍스트를 생성하고 변수, 함수 등의 선언문만 먼저 실행하여 생성된 변수나 함수 식별자를 키로 실행 컨텍스트가 관리하는 스코프(렉시컬 환경의 환경 레코드)에 등록한다.**

소스코드 평가 과정이 끝나면 선언문을 제외한 소스코드가 순차적으로 실행된다. 즉, 런타임이 시작된다. 이때 **소스코드 실행에 필요한 정보, 즉 변수나 함수의 참조를 실행 컨텍스트가 관리하는 스코프에서 검색해서 취득**한다. 그리고 변수 값의 변경 등 **소스코드의 실행 결과는 다시 실행 컨텍스트가 관리하는 스코프에 등록**된다.

## 실행 컨텍스트란?

컨텍스트는 문맥을 뜻한다. 문맥이란 글에 표현된 의미의 앞뒤 연결을 의미하는데, 여기서는 환경이라고 이해하면 된다. **즉, 실행 컨텍스트란 코드 실행 환경을 말한다.**

## 실행 컨텍스트의 역할

그렇다면 실행 컨텍스트는 어떤 일을 할까? 아래 코드가 어떻게 실행되는지 보자.

```js
// 전역 변수 선언
const x = 1;
const y = 2;

// 함수 정의
function foo(a) {
  // 지역 변수 선언
  const x = 10;
  const y = 20;

  // 메서드 호출
  console.log(a + x + y); // 130
}

// 함수 호출
foo(100);

// 메서드 호출
console.log(x + y); // 3
```

1. **전역 코드 평가 :** 전역 코드에서 선언문만 먼저 실행되고 그 결과로 생성된 전역 변수와 전역 함수가 실행 컨텍스트가 관리하는 전역 스코프에 등록됨
2. **전역 코드 실행 :** 전역 변수에 값이 할당되고 함수가 호출됨. 함수가 호출되면 함수 내부로 진입
3. **함수 코드 평가 :**

- 매개변수와 지역 변수 선언문이 먼저 실행되고 그 결과 생성된 매개변수와 지역 변수가 실행 컨텍스트가 관리하는 지역 스코프로 등록됨
- 그 외에 함수 내부에서 지역 변수처럼 사용할 수 있는 arguments 객체가 생성되어 지역 스코프에 등록되고 this 바인딩도 결정됨

4. **함수 코드 실행 :**

- 매개변수와 지역 변수에 값이 할당되고 `console.log()`가 호출됨
- `console.log()`를 호출하기 위해 식별자인 `console`을 스코프 체인을 통해 검색
- `log` 프로퍼티를 `console` 객체의 프로토타입 체인을 통해 검색한 후 인수로 전달된 표현식 `a + x + y`가 평가됨
- `a + x + y` 식별자는 스코프 체인을 통해 검색. `console.log()`가 종료되면 함수 코드 실행 과정이 종료되고 함수 호출 이전으로 돌아가 전역 코드를 마저 실행

**위 과정처럼 코드가 실행되려면 다음과 같이 스코프, 식별자, 코드 실행 순서 등의 관리가 필요하다.**

✅ 선언에 의해 생성된 모든 식별자를 스코프를 구분하여 등록하고 상태 변화를 지속적으로 관리
✅ 스코프는 중첩 관계에 의해 스코프 체인을 형성. 즉, 스코프 체인을 통해 상위 스코프로 이동하며 식별자를 검색할 수 있어야 함
✅ 현재 실행 중인 코드의 실행 순서를 변경할 수 있어야 하며 다시 되돌아갈 수도 있어야 함

👉 **즉, 실행 컨텍스트는 소스코드를 실행하는데 필요한 환경을 제공하고 코드의 실행 결과를 관리하는 역할을 한다.**

## 실행 컨텍스트의 구성

실행 컨텍스트는 `VariableEnvironment`, `LexicalEnvironment`, `This Binding`으로 구성된다.

이 중 `VariableEnvironment`, `LexicalEnvironment`는 생성 초기에 동일한 렉시컬 환경을 참조하는데, 생성 초기의 실행 컨텍스트와 렉시컬 환경을 그림으로 표현하면 아래와 같다.

![](/posts/what_is_execution_context/execution_context.png)

> 렉시컬 환경이란?
>
> 렉시컬 환경은 식별자와 식별자에 바인딩된 값을 저장하는 `환경 레코드(environmentRecord)`와 상위 스코프를 가리키는 `외부 렉시컬 환경에 대한 참조(outerEnvironmentReference)`로 구성되는 자료구조다.

`VariableEnvironment`, `LexicalEnvironment`는 생성 초기에 동일한 렉시컬 환경을 참조하지만 이후 변경 사항이 생기면 `LexicalEnvironment`에 실시간으로 적용되며 달라진다. 즉, `VariableEnvironment`는 초기 상태를 기억하고 있으며, `LexicalEnvironment`는 최신 상태를 저장한다.

마지막으로 `This Binding`에는 this로 지정된 객체가 저장된다.

## 정리

- 자바스크립트 엔진은 소스코드를 평가와 실행 과정으로 나누어 처리한다.
- 소스코드 평가 과정에서 실행 컨텍스트를 생성하는데 실행 컨텍스트란 코드 실행 환경을 말한다.
- 실행 컨텍스트는 소스코드를 실행하는데 필요한 환경을 제공하고 코드의 실행 결과를 관리하는 역할을 한다.
- 실행 컨텍스트의 구성은 `VariableEnvironment`, `LexicalEnvironment`, `This Binding`이며 그중 `VariableEnvironment`, `LexicalEnvironment`는 생성 초기에 동일한 렉시컬 환경을 참조하지만 이후 변경 사항이 생기면 `LexicalEnvironment`이 변경되며 달라진다.
- 렉시컬 환경이란 식별자를 관리하는 환경 레코드와 상위 스코프를 가리키는 외부 렉시컬 환경에 대한 참조로 구성된 자료구조다.

## 참고

- [모던 자바스크립트 Deep Dive](https://www.notion.so/9-23-dd2a2cd94cdc4a6788386fe1fcc312b4)
- [실행 컨텍스트](https://www.zerocho.com/category/JavaScript/post/5741d96d094da4986bc950a0)
- [JS Execution Context (실행 컨텍스트) 란?](https://gamguma.dev/post/2022/04/js_execution_context)
- [하루의 실행 컨텍스트](https://www.youtube.com/watch?v=EWfujNzSUmw)
